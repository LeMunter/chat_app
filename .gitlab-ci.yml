# This file defines the pipeline that runs when
# pushing to gitlab! // STEFFE
variables:
  TESTVAR: hejhej

stages:
  - build
  - hello-world

build:
  image: docker:dind
  stage: build
  script:
    - docker build -t gitlab.lnu.se:5050/2dv612/student/team-1---ht21/project:${CI_COMMIT_SHORT_SHA} postgres/
    - docker push gitlab.lnu.se:5050/2dv612/student/team-1---ht21/project:${CI_COMMIT_SHORT_SHA}

test:
  image: node:latest
  stage: hello-world
  script:
    - echo "hello $TESTVAR"
  only: 
    - pipeline-test

# # Test building node_modules in /server and store it in artifact repository
# build_npm1:
#   image: node:latest
#   stage: build
#   script:
#    - npm install ./server
#   only:             # Pipeline will only trigger on commits 
#     - pipeline-test # to this branch
#   except: # ignore anton's work
#     changes:
#       - infrastructure/*
#   artifacts:
#     name: hello
#     when: on_success
#     paths:
#       - node_modules/
# #  environment:           # Don't use this until we actually
# #    name: not_production # deploy to production :)

# # Artifacts /client
# build_npm2:
#   image: node:latest
#   stage: build
#   script:
#    - npm install ./client
#   only: 
#     - pipeline-test
#   except: # ignore anton's work
#     changes:
#       - infrastructure/*
#   artifacts:
#     name: npm_client
#     when: on_success
#     paths:
#       - node_modules/
